# 이벤트 스토밍 주문 서비스팀 도메인별 예시

> 이 문서는 [이벤트스토밍_주문서비스팀_가이드.md](./이벤트스토밍_주문서비스팀_가이드.md)의 보충 자료입니다.

---

## 5. 주문 도메인별 이벤트 예시 모음 (8개 도메인)

### 5.1 주문 생성 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                      주문 생성 도메인                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 장바구니에 상품이 담겼다                                │
│  • 장바구니 수량이 변경되었다                              │
│  • 장바구니에서 상품이 제거되었다                          │
│  • 주문이 접수되었다                                       │
│  • 주문이 확정되었다                                       │
│  • 배송지가 선택되었다                                     │
│  • 배송지가 추가되었다                                     │
│  • 배송 요청사항이 등록되었다                              │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 장바구니에 담기                                         │
│  • 수량 변경하기                                           │
│  • 주문하기                                                │
│  • 배송지 선택하기                                         │
│  • 배송지 추가하기                                         │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 장바구니                                                │
│  • 주문서                                                  │
│  • 배송지                                                  │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "최소 주문 금액 10,000원 이상"                          │
│  • "장바구니 상품 최대 30개"                               │
│  • "품절 상품은 주문 불가"                                 │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 장바구니 상품 재고 실시간 체크 주기                     │
│  • 비회원 장바구니 → 회원 전환 시 병합 방법                │
│  • 묶음 배송 가능 상품 판단 기준                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 주문 생성 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    주문 생성 이벤트 흐름                    │
└─────────────────────────────────────────────────────────────┘

[고객] 🧑
   │
   ▼
🟦 장바구니에 담기
   │
   ▼  🟨
🟧 장바구니 ─ 상품이 장바구니에 담겼다
   │
   ├─(옵션)───────────────────────┐
   ▼                              ▼
🟦 수량 변경하기              🟦 상품 제거하기
   │                              │
   ▼                              ▼
🟧 수량이 변경되었다          🟧 상품이 제거되었다
   │                              │
   └──────────────┬───────────────┘
                  │
                  ▼
🟦 주문하기
   │
   ├──→ 🟩 상품팀: 재고 확인 요청
   │
   ▼  🟨
🟧 주문서 ─ 주문이 접수되었다
   │
   ├──→ 🟩 결제팀: 결제 요청
   ├──→ 고객: "주문 접수" 알림
   │
   ▼
(결제 프로세스로 이동)
```

---

### 5.2 결제 연동 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                      결제 연동 도메인                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 결제가 요청되었다                                       │
│  • 결제가 승인되었다                                       │
│  • 결제가 거부되었다 (잔액 부족)                           │
│  • 결제가 거부되었다 (카드 한도 초과)                      │
│  • 결제가 거부되었다 (카드 상태 문제)                      │
│  • 결제가 거부되었다 (결제 정보 오류)                      │
│  • 결제가 타임아웃되었다                                   │
│  • 결제가 취소되었다 (고객 취소)                           │
│  • 주문 결제가 완료되었다                                  │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 결제 수단 선택하기                                      │
│  • 결제하기                                                │
│  • 결제 취소하기                                           │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 결제 정보                                               │
│  • 주문 결제                                               │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • PG사 API                                                │
│  • 결제팀 서비스                                           │
│  • 카드사 시스템                                           │
│  • 간편결제 (카카오페이, 네이버페이 등)                    │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "결제 타임아웃 5분"                                     │
│  • "결제 실패 시 3회 재시도 허용"                          │
│  • "100만원 이상 결제 시 본인인증 필수"                    │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 이중 결제 방지 방법                                     │
│  • 결제 중 앱 종료 시 복구 방법                            │
│  • 복합 결제(카드+포인트) 실패 시 롤백 순서                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 결제 연동 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    결제 연동 이벤트 흐름                    │
└─────────────────────────────────────────────────────────────┘

주문팀                              🟩 결제팀/PG사
────────────────────────────────────────────────────────────

🟧 주문이 접수되었다
   │
   ▼
🟦 결제하기 (고객)
   │
   ▼
🟧 결제가 요청되었다  ─────────────→  결제 처리 시작
   │                                       │
   │  💜 "결제 타임아웃 5분"               │
   │                                       │
   │ (타임아웃 대기)                        │
   │                                       │
   │                      ┌────────────────┴───────────────┐
   │                      │                                │
   │                      ▼                                ▼
   │              🟧 결제 승인                     🟧 결제 거부
   │               (결제팀 발행)                   (결제팀 발행)
   │                      │                                │
   ▼                      │                                │
┌──────────────────────────────────────────────────────────┐
│ 주문팀에서 수신                                          │
└──────────────────────────────────────────────────────────┘
   │                      │                                │
   ▼                      ▼                                ▼
🟧 주문 결제가          🟧 결제가 거부되었다
   완료되었다            (잔액 부족)
   │                      │
   │                      └──→ 고객: "결제 실패" 알림
   │                           "다른 카드를 사용해주세요"
   ▼
🟩 물류팀: 배송 요청
```

---

### 5.3 재고 연동 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                      재고 연동 도메인                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 재고 확보가 요청되었다                                  │
│  • 재고가 확보되었다                                       │
│  • 재고가 부족하다                                         │
│  • 재고가 복원되었다 (주문 취소 시)                        │
│  • 재고 확보가 만료되었다 (타임아웃)                       │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 재고 확보 요청하기                                      │
│  • 재고 복원 요청하기                                      │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 상품팀 재고 서비스                                      │
│  • 재고 관리 시스템 (WMS)                                  │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "재고 확보 유효 시간 30분"                              │
│  • "재고 부족 시 유사 상품 추천"                           │
│  • "예약 판매 상품은 재고 확인 없이 주문 가능"             │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 동시 주문 시 재고 경쟁 상황 처리                        │
│  • 실시간 재고 vs 배치 재고 동기화 타이밍                  │
│  • 멀티 창고 재고 배분 로직                                │
│  • 재고 확보 만료 시 고객 알림 방법                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 재고 연동 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    재고 연동 이벤트 흐름                    │
└─────────────────────────────────────────────────────────────┘

주문팀                              🟩 상품팀
────────────────────────────────────────────────────────────

🟧 주문이 접수되었다
   │
   ▼
🟦 재고 확보 요청하기
   │
   ▼
🟧 재고 확보가 요청되었다  ─────→  재고 확인/차감
   │                                    │
   │  💜 "재고 확보 유효 30분"          │
   │                                    │
   │                    ┌───────────────┴────────────────┐
   │                    │                                │
   │                    ▼                                ▼
   │            재고 차감 성공                     재고 부족
   │                    │                                │
   ▼                    │                                │
┌──────────────────────────────────────────────────────────┐
│ 주문팀에서 수신                                          │
└──────────────────────────────────────────────────────────┘
   │                    │                                │
   ▼                    ▼                                ▼
🟧 재고가 확보되었다                    🟧 재고가 부족하다
   │                                          │
   │                                          ▼
   │                                   💜 "재고 부족 시
   │                                      유사 상품 추천"
   │                                          │
   ▼                                          ▼
결제 프로세스 진행                     🟧 주문이 취소되었다
                                          (재고 부족)


[주문 취소 시 재고 복원]

🟧 주문이 취소되었다
   │
   ▼
🟦 재고 복원 요청하기
   │
   ▼
🟧 재고 복원이 요청되었다  ─────→  🟩 상품팀
   │                                    │
   ▼                                    ▼
🟧 재고가 복원되었다            재고 +1 처리
```

---

### 5.4 배송 연동 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                      배송 연동 도메인                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 배송이 요청되었다                                       │
│  • 출고가 시작되었다                                       │
│  • 배송이 시작되었다                                       │
│  • 배송 중 상태가 업데이트되었다                           │
│  • 배송이 완료되었다                                       │
│  • 배송이 실패했다 (주소 오류)                             │
│  • 배송이 실패했다 (수령인 부재)                           │
│  • 배송이 반송되었다                                       │
│  • 배송 일정이 변경되었다                                  │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 배송 요청하기                                           │
│  • 배송 추적하기                                           │
│  • 배송지 변경 요청하기                                    │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 배송 정보                                               │
│  • 송장                                                    │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 물류팀 서비스                                           │
│  • 택배사 API                                              │
│  • 창고 관리 시스템 (WMS)                                  │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "결제 완료 후 자동 출고 요청"                           │
│  • "배송 3회 실패 시 자동 반송"                            │
│  • "출고 후 배송지 변경 불가"                              │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 묶음 배송 가능 여부 판단 기준                           │
│  • 부분 출고 시 송장 분리 처리                             │
│  • 도서산간 배송 가능 여부 실시간 확인                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 배송 연동 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    배송 연동 이벤트 흐름                    │
└─────────────────────────────────────────────────────────────┘

주문팀                              🟩 물류팀/택배사
────────────────────────────────────────────────────────────

🟧 주문 결제가 완료되었다
   │
   ▼
💜 "결제 완료 후 자동 출고 요청"
   │
   ▼
🟦 배송 요청하기
   │
   ▼
🟧 배송이 요청되었다  ─────────────→  출고 처리 시작
   │                                       │
   │                                       ▼
   │                               🟧 출고가 시작되었다
   │                                       │
   │                                       ▼
   │                               피킹/포장/송장발급
   │                                       │
   ▼                                       ▼
🟧 출고가 완료되었다  ←─────────────  출고 완료
   │                                       │
   │                                       ▼
   │                               🟧 배송이 시작되었다
   │                                       │
   ▼                                       ▼
🟧 주문 배송이                     배송 추적 정보 업데이트
   시작되었다                             │
   │                                       │
   ├──→ 고객: "배송 시작" 알림 (송장번호)  │
   │                                       │
   │                               🟧 배송 중 업데이트
   │                               (터미널 도착, 배송 출발 등)
   │                                       │
   ▼                                       ▼
🟧 주문 배송이  ←─────────────────  🟧 배송이 완료되었다
   완료되었다
   │
   ├──→ 고객: "배송 완료" 알림
   │
   ▼
💜 "배송 완료 7일 후 자동 구매 확정"
```

---

### 5.5 취소/환불 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                     취소/환불 도메인                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 주문 취소가 요청되었다                                  │
│  • 주문이 취소되었다 (고객 요청)                           │
│  • 주문이 취소되었다 (재고 부족)                           │
│  • 주문이 취소되었다 (결제 실패)                           │
│  • 주문이 취소되었다 (배송 불가)                           │
│  • 환불이 요청되었다                                       │
│  • 환불이 승인되었다                                       │
│  • 환불이 완료되었다                                       │
│  • 부분 환불이 요청되었다                                  │
│  • 부분 환불이 완료되었다                                  │
│  • 환불이 거부되었다                                       │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 주문 취소 요청하기                                      │
│  • 환불 요청하기                                           │
│  • 부분 환불 요청하기                                      │
│  • 환불 승인하기 (관리자)                                  │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 취소 요청                                               │
│  • 환불 정보                                               │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 결제팀: 환불 처리                                       │
│  • 상품팀: 재고 복원                                       │
│  • 프로모션팀: 쿠폰/포인트 복원                            │
│  • 물류팀: 반품 수거                                       │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "배송 전 취소는 즉시 처리"                              │
│  • "배송 후 7일 이내 반품 가능"                            │
│  • "10만원 이상 환불은 관리자 승인 필요"                   │
│  • "사용된 쿠폰은 환불 시 복원 불가"                       │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 복합 결제(카드+포인트) 환불 시 비율 계산                │
│  • 부분 취소 시 할인 금액 재계산                           │
│  • 출고 중 취소 요청 처리 방법                             │
│  • 교환과 환불의 프로세스 차이                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 취소/환불 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    주문 취소 이벤트 흐름                    │
└─────────────────────────────────────────────────────────────┘

[배송 전 취소]

[고객] 🧑
   │
   ▼
🟦 주문 취소 요청하기
   │
   ▼
🟧 주문 취소가 요청되었다
   │
   ▼
💜 "배송 전 취소는 즉시 처리"
   │
   ▼
🟧 주문이 취소되었다 (고객 요청)
   │
   ├──→ 🟩 결제팀: 환불 요청
   │         └──→ 🟧 환불이 완료되었다
   │
   ├──→ 🟩 상품팀: 재고 복원 요청
   │         └──→ 🟧 재고가 복원되었다
   │
   ├──→ 🟩 프로모션팀: 쿠폰 복원 요청
   │         └──→ 🟧 쿠폰이 복원되었다
   │
   └──→ 고객: "주문 취소 완료" 알림


[배송 후 환불 (반품)]

[고객] 🧑
   │
   ▼
🟦 환불 요청하기
   │
   ▼
🟧 환불이 요청되었다
   - 환불 사유: 상품 불량
   - 반품 필요: 예
   │
   ├──→ 🟩 물류팀: 반품 수거 요청
   │
   ▼
💜 "반품 수거 완료 후 환불 처리"
   │
   (반품 수거 대기)
   │
   ▼
🟧 반품이 수거되었다  ←───  🟩 물류팀
   │
   ▼
🟧 환불이 승인되었다
   │
   ├──→ 🟩 결제팀: 환불 처리
   │
   ▼
🟧 환불이 완료되었다
   │
   └──→ 고객: "환불 완료" 알림


[부분 환불]

🟧 부분 환불이 요청되었다
   - 대상 상품: [상품 A]
   - 환불 금액: 10,000원
   - 환불 사유: 상품 불량
   │
   ▼
🟧 부분 환불이 승인되었다
   │
   ├──→ 🟩 결제팀: 부분 환불 처리 (10,000원)
   │
   ▼
🟧 부분 환불이 완료되었다
   - 잔여 주문 금액: 20,000원
   - 주문 상태: "부분 환불됨"
```

---

### 5.6 프로모션/할인 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                    프로모션/할인 도메인                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 쿠폰이 적용되었다                                       │
│  • 쿠폰 적용이 실패했다 (조건 미충족)                      │
│  • 쿠폰 적용이 실패했다 (이미 사용됨)                      │
│  • 쿠폰 적용이 실패했다 (유효기간 만료)                    │
│  • 포인트가 사용되었다                                     │
│  • 포인트 사용이 실패했다 (잔액 부족)                      │
│  • 할인 금액이 확정되었다                                  │
│  • 쿠폰이 복원되었다 (주문 취소 시)                        │
│  • 포인트가 복원되었다 (주문 취소 시)                      │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 쿠폰 적용하기                                           │
│  • 쿠폰 제거하기                                           │
│  • 포인트 사용하기                                         │
│  • 포인트 취소하기                                         │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 적용 쿠폰                                               │
│  • 사용 포인트                                             │
│  • 할인 내역                                               │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 프로모션팀 쿠폰 서비스                                  │
│  • 회원팀 포인트 서비스                                    │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "VIP 회원 5% 추가 할인" (자동 적용)                     │
│  • "10만원 이상 무료배송" (자동 적용)                      │
│  • "쿠폰 중복 사용 불가"                                   │
│  • "최대 할인 금액 제한"                                   │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 동시 쿠폰 사용 요청 시 검증 타이밍                      │
│  • 부분 취소 시 할인 금액 재계산                           │
│  • 카테고리 할인과 상품 할인 중복 적용 기준                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 프로모션 적용 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                  프로모션 적용 이벤트 흐름                  │
└─────────────────────────────────────────────────────────────┘

[쿠폰 적용 - 고객 행동]

[고객] 🧑
   │
   ▼
🟦 쿠폰 적용하기
   │
   ├──→ 🟩 프로모션팀: 쿠폰 유효성 검증
   │
   ▼
┌──────────────────────────────────────────────────────────┐
│ 검증 결과                                                │
└──────────────────────────────────────────────────────────┘
   │
   ├─(유효)────────────────────────────┐
   │                                    │
   ├─(조건 미충족)─────────────────┐   │
   │                               │   │
   ├─(이미 사용됨)─────────────┐   │   │
   │                           │   │   │
   └─(유효기간 만료)─────┐     │   │   │
                         │     │   │   │
                         ▼     ▼   ▼   ▼
🟧 쿠폰 적용 실패       🟧 쿠폰 적용 실패   🟧 쿠폰이
   (유효기간 만료)         (조건 미충족)      적용되었다
                                              │
                                              ▼
                                        주문 금액 재계산


[자동 할인 - 정책 적용]

🟧 주문이 접수되었다
   │
   ▼
💜 "VIP 회원 5% 추가 할인"
💜 "10만원 이상 무료배송"
   │
   ▼
(주문 금액에 자동 반영)
   │
   ▼
🟧 할인 금액이 확정되었다
   - 상품 금액: 120,000원
   - 쿠폰 할인: -10,000원
   - VIP 할인: -5,500원
   - 배송비: 0원 (무료배송)
   - 최종 금액: 104,500원
```

---

### 5.7 정산 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                       정산 도메인                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 일별 정산이 완료되었다                                  │
│  • 판매자 정산금이 확정되었다                              │
│  • 수수료 계산이 완료되었다                                │
│  • 정산 내역이 생성되었다                                  │
│  • 정산금 지급이 요청되었다                                │
│  • 정산금 지급이 완료되었다                                │
│  • 정산 오류가 발생했다                                    │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 일별 정산 실행하기 (배치)                               │
│  • 정산금 지급 요청하기                                    │
│  • 정산 내역 조회하기                                      │
│                                                             │
│  🟨 애그리게잇 예시                                        │
│  ─────────────────────────────────────────────────────────  │
│  • 정산 내역                                               │
│  • 수수료 정보                                             │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 재무팀 서비스                                           │
│  • 은행 송금 API                                           │
│  • 세금계산서 발행 시스템                                  │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "구매 확정 기준 정산"                                   │
│  • "환불 건 정산 차감"                                     │
│  • "수수료율 카테고리별 차등 적용"                         │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 정산 마감 후 환불 발생 시 처리                          │
│  • 복합 결제 건 수수료 계산 기준                           │
│  • 프로모션 비용 분담 정책                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 정산 프로세스 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                    정산 프로세스 흐름                       │
└─────────────────────────────────────────────────────────────┘

[야간 배치 정산]

🤖 시스템 (야간 배치 - 매일 02:00)
   │
   ▼
🟦 일별 정산 실행하기
   │
   ├──→ 전일 구매 확정 주문 조회
   ├──→ 환불/취소 건 차감
   ├──→ 카테고리별 수수료 계산
   ├──→ 판매자별 정산금 집계
   │
   ▼
🟧 일별 정산이 완료되었다
   - 정산 대상일: 2024-01-15
   - 총 정산 건수: 1,234건
   - 총 정산 금액: 123,456,789원
   │
   ├──→ 🟧 판매자 정산금이 확정되었다 (판매자 A)
   │         - 판매 금액: 1,000,000원
   │         - 수수료: -100,000원
   │         - 정산금: 900,000원
   │
   ├──→ 🟧 판매자 정산금이 확정되었다 (판매자 B)
   │         ...
   │
   ▼
🟧 정산 내역이 생성되었다
   │
   ├──→ 운영팀: 정산 리포트 알림
   │
   ▼
(정산금 지급 프로세스)


[정산금 지급]

🤖 시스템 (주간 배치 - 매주 화요일)
   │
   ▼
🟦 정산금 지급 요청하기
   │
   ▼
🟧 정산금 지급이 요청되었다  ──────→  🟩 재무팀
   │                                       │
   │                                       ▼
   │                               🟩 은행 송금 API
   │                                       │
   ▼                                       │
🟧 정산금 지급이 완료되었다  ←─────────────┘
   │
   └──→ 판매자: "정산금 입금 완료" 알림
```

---

### 5.8 회원 연동 도메인

```
┌─────────────────────────────────────────────────────────────┐
│                      회원 연동 도메인                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🟧 도메인 이벤트                                          │
│  ─────────────────────────────────────────────────────────  │
│  • 포인트가 적립되었다                                     │
│  • 구매 이력이 기록되었다                                  │
│  • 회원 등급이 변경되었다                                  │
│  • 등급 혜택이 적용되었다                                  │
│  • 마일리지가 적립되었다                                   │
│  • 누적 구매 금액이 업데이트되었다                         │
│                                                             │
│  🟦 커맨드 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 포인트 적립 요청하기                                    │
│  • 구매 이력 기록하기                                      │
│  • 등급 업데이트 요청하기                                  │
│                                                             │
│  🟩 외부 시스템                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 회원팀 서비스                                           │
│  • 포인트 서비스                                           │
│  • CRM 시스템                                              │
│                                                             │
│  💜 정책 예시                                              │
│  ─────────────────────────────────────────────────────────  │
│  • "구매 확정 시 1% 포인트 적립"                           │
│  • "월 50만원 이상 구매 시 VIP 승급"                       │
│  • "생일 월 2배 포인트"                                    │
│                                                             │
│  🩷 핫스팟 예시                                            │
│  ─────────────────────────────────────────────────────────  │
│  • 환불 시 적립 포인트 회수 정책                           │
│  • 등급 강등 시점 및 기준                                  │
│  • 비회원 주문 후 회원 가입 시 혜택 소급 적용              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 회원 연동 흐름 예시

```
┌─────────────────────────────────────────────────────────────┐
│                   회원 연동 이벤트 흐름                     │
└─────────────────────────────────────────────────────────────┘

[구매 확정 시 포인트 적립]

🟧 주문이 완료되었다 (구매 확정)
   │
   ▼
💜 "구매 확정 시 1% 포인트 적립"
   │
   ▼
🟦 포인트 적립 요청하기
   │
   ▼
🟧 포인트 적립이 요청되었다  ──────→  🟩 회원팀
   - 회원 ID: user123                      │
   - 적립 사유: 주문 완료                  │
   - 적립 금액: 500P                       │
   │                                       │
   │                                       ▼
   │                               포인트 처리 완료
   │                                       │
   ▼                                       │
🟧 포인트가 적립되었다  ←──────────────────┘
   │
   └──→ 고객: "500P 적립" 알림


[구매 이력 및 등급 업데이트]

🟧 주문이 완료되었다
   │
   ▼
🟦 구매 이력 기록하기  ──────────→  🟩 회원팀/CRM
   │                                       │
   │                                       ▼
   │                              구매 이력 저장
   │                              누적 구매 금액 업데이트
   │                                       │
   ▼                                       │
🟧 구매 이력이 기록되었다  ←───────────────┘
   │
   ▼
🟧 누적 구매 금액이 업데이트되었다
   - 이번 달 구매: 500,000원
   - 누적 구매: 2,000,000원
   │
   ▼
💜 "월 50만원 이상 구매 시 VIP 승급"
   │
   ▼
🟧 회원 등급이 변경되었다
   - 이전 등급: GOLD
   - 변경 등급: VIP
   │
   └──→ 고객: "VIP 등급 승급" 알림
```

---

## 6. 다른 팀과의 연동 지점 명확화

### 6.1 연동 맵 시각화

```
┌─────────────────────────────────────────────────────────────┐
│                주문팀 연동 지점 전체 맵                     │
└─────────────────────────────────────────────────────────────┘

                    ┌─────────────┐
                    │  🟩 상품팀   │
                    │             │
                    │ 재고 확보   │
                    │ 재고 복원   │
                    └──────┬──────┘
                           │
                           │ 재고 확보/복원 요청
                           │ 재고 상태 응답
                           │
     ┌─────────────┐       │       ┌─────────────┐
     │ 🟩 프로모션팀│       │       │ 🟩 결제팀   │
     │             │       │       │             │
     │ 쿠폰 사용   │       │       │ 결제 요청   │
     │ 쿠폰 복원   │       │       │ 환불 요청   │
     └──────┬──────┘       │       └──────┬──────┘
            │              │              │
            │ 쿠폰 유효성  │              │ 결제 승인/거부
            │ 쿠폰 처리    │              │ 환불 완료
            │              │              │
            └──────────────┼──────────────┘
                           │
                    ┌──────┴──────┐
                    │             │
                    │   주문팀    │
                    │             │
                    │  🟧 이벤트  │
                    │   발행/수신 │
                    │             │
                    └──────┬──────┘
                           │
            ┌──────────────┼──────────────┐
            │              │              │
     ┌──────┴──────┐       │       ┌──────┴──────┐
     │ 🟩 물류팀   │       │       │ 🟩 회원팀   │
     │             │       │       │             │
     │ 배송 요청   │       │       │ 포인트 적립 │
     │ 반품 수거   │       │       │ 포인트 사용 │
     │ 배송 상태   │       │       │ 등급 조회   │
     └─────────────┘       │       └─────────────┘
                           │
                    ┌──────┴──────┐
                    │ 🟩 재무팀   │
                    │             │
                    │ 정산 처리   │
                    │ 정산금 지급 │
                    └─────────────┘
```

### 6.2 입력/출력 연동 테이블

#### 상품팀 연동

```
┌─────────────────────────────────────────────────────────────┐
│                      상품팀 연동                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 - 상품팀에서 받는 것]                               │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 재고가 확보됨    │ 상품ID, 확보수량, 유효시간       │  │
│  │ 재고가 부족함    │ 상품ID, 현재재고, 요청수량       │  │
│  │ 재고가 복원됨    │ 상품ID, 복원수량                 │  │
│  │ 상품 정보 변경됨 │ 상품ID, 변경항목, 변경값         │  │
│  │ 상품 판매 중지됨 │ 상품ID, 중지사유                 │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
│  [출력 - 상품팀으로 보내는 것]                             │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 재고 확보 요청   │ 주문ID, 상품ID, 요청수량         │  │
│  │ 재고 복원 요청   │ 주문ID, 상품ID, 복원수량, 사유   │  │
│  │ 재고 확보 취소   │ 주문ID, 상품ID                   │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 결제팀 연동

```
┌─────────────────────────────────────────────────────────────┐
│                      결제팀 연동                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 - 결제팀에서 받는 것]                               │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 결제가 승인됨    │ 주문ID, 승인번호, 결제금액,      │  │
│  │                  │ 결제수단, 승인일시               │  │
│  │ 결제가 거부됨    │ 주문ID, 거부사유, 거부코드       │  │
│  │ 결제 타임아웃    │ 주문ID                           │  │
│  │ 환불이 완료됨    │ 주문ID, 환불금액, 환불일시       │  │
│  │ 부분환불 완료    │ 주문ID, 환불금액, 잔여금액       │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
│  [출력 - 결제팀으로 보내는 것]                             │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 결제 요청        │ 주문ID, 결제금액, 결제수단,      │  │
│  │                  │ 주문자정보, 결제상품정보         │  │
│  │ 결제 취소 요청   │ 주문ID, 취소사유                 │  │
│  │ 환불 요청        │ 주문ID, 환불금액, 환불사유       │  │
│  │ 부분환불 요청    │ 주문ID, 환불상품, 환불금액       │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 물류팀 연동

```
┌─────────────────────────────────────────────────────────────┐
│                      물류팀 연동                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 - 물류팀에서 받는 것]                               │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 출고가 시작됨    │ 주문ID, 출고일시, 예상배송일     │  │
│  │ 출고가 완료됨    │ 주문ID, 송장번호, 택배사         │  │
│  │ 배송이 시작됨    │ 주문ID, 송장번호, 배송기사정보   │  │
│  │ 배송 상태 변경   │ 주문ID, 배송상태, 현재위치       │  │
│  │ 배송이 완료됨    │ 주문ID, 완료일시, 수령인         │  │
│  │ 배송이 실패함    │ 주문ID, 실패사유, 재배송일정     │  │
│  │ 반품이 수거됨    │ 주문ID, 수거일시, 상품상태       │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
│  [출력 - 물류팀으로 보내는 것]                             │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 배송 요청        │ 주문ID, 상품목록, 배송지,        │  │
│  │                  │ 수령인정보, 요청사항             │  │
│  │ 배송 취소 요청   │ 주문ID, 취소사유                 │  │
│  │ 배송지 변경 요청 │ 주문ID, 변경배송지               │  │
│  │ 반품 수거 요청   │ 주문ID, 수거지, 수거상품         │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 회원팀 연동

```
┌─────────────────────────────────────────────────────────────┐
│                      회원팀 연동                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 - 회원팀에서 받는 것]                               │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 회원 정보 조회   │ 회원ID, 등급, 포인트잔액, 혜택   │  │
│  │ 포인트가 적립됨  │ 회원ID, 적립포인트, 총잔액       │  │
│  │ 포인트가 사용됨  │ 회원ID, 사용포인트, 잔여포인트   │  │
│  │ 포인트 사용 실패 │ 회원ID, 실패사유                 │  │
│  │ 포인트가 복원됨  │ 회원ID, 복원포인트               │  │
│  │ 등급이 변경됨    │ 회원ID, 이전등급, 변경등급       │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
│  [출력 - 회원팀으로 보내는 것]                             │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 포인트 적립 요청 │ 회원ID, 주문ID, 적립금액, 사유   │  │
│  │ 포인트 사용 요청 │ 회원ID, 주문ID, 사용금액         │  │
│  │ 포인트 복원 요청 │ 회원ID, 주문ID, 복원금액, 사유   │  │
│  │ 구매 이력 기록   │ 회원ID, 주문ID, 구매금액, 상품   │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 프로모션팀 연동

```
┌─────────────────────────────────────────────────────────────┐
│                     프로모션팀 연동                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 - 프로모션팀에서 받는 것]                           │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 쿠폰 유효성 확인 │ 쿠폰코드, 유효여부, 할인금액,    │  │
│  │                  │ 사용조건                         │  │
│  │ 쿠폰이 사용됨    │ 쿠폰코드, 사용일시               │  │
│  │ 쿠폰 사용 실패   │ 쿠폰코드, 실패사유               │  │
│  │ 쿠폰이 복원됨    │ 쿠폰코드, 복원일시               │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
│  [출력 - 프로모션팀으로 보내는 것]                         │
│  ┌──────────────────┬──────────────────────────────────┐  │
│  │ 이벤트           │ 데이터 항목                       │  │
│  ├──────────────────┼──────────────────────────────────┤  │
│  │ 쿠폰 유효성 요청 │ 쿠폰코드, 회원ID, 주문금액       │  │
│  │ 쿠폰 사용 요청   │ 쿠폰코드, 주문ID, 회원ID         │  │
│  │ 쿠폰 복원 요청   │ 쿠폰코드, 주문ID, 복원사유       │  │
│  └──────────────────┴──────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 이벤트 소유권 원칙

```
┌─────────────────────────────────────────────────────────────┐
│                  이벤트 소유권 원칙                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  핵심 원칙: "누가 상태를 변경하는가?"                      │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  상태 변경 주체 = 이벤트 발행 주체                         │
│                                                             │
│  예시:                                                     │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 상태                   │ 소유 팀    │ 이벤트 발행 팀 │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │ 주문 상태 (접수/확정)  │ 주문팀     │ 주문팀         │  │
│  │ 결제 상태 (승인/거부)  │ 결제팀     │ 결제팀         │  │
│  │ 재고 상태 (확보/부족)  │ 상품팀     │ 상품팀         │  │
│  │ 배송 상태 (시작/완료)  │ 물류팀     │ 물류팀         │  │
│  │ 포인트 상태 (적립/사용)│ 회원팀     │ 회원팀         │  │
│  │ 쿠폰 상태 (사용/복원)  │ 프로모션팀 │ 프로모션팀     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  주문팀의 역할:                                            │
│  • 다른 팀의 이벤트를 "수신"하여                          │
│  • 주문 관점의 "새로운 이벤트"를 발행                      │
│                                                             │
│  예시:                                                     │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  🟩 결제팀                                            │  │
│  │     │                                                 │  │
│  │     │ "결제가 승인되었다" (결제팀 이벤트)            │  │
│  │     │                                                 │  │
│  │     ▼                                                 │  │
│  │  주문팀 (수신)                                        │  │
│  │     │                                                 │  │
│  │     │ 주문 상태를 "결제 완료"로 변경                 │  │
│  │     │                                                 │  │
│  │     ▼                                                 │  │
│  │  "주문 결제가 완료되었다" (주문팀 이벤트)            │  │
│  │     │                                                 │  │
│  │     └──→ 🟩 물류팀 (배송 프로세스 시작)             │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.4 연동 이벤트 명명 규칙

```
┌─────────────────────────────────────────────────────────────┐
│                  연동 이벤트 명명 규칙                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 요청 이벤트 (주문팀 → 타팀)                            │
│     • "~가 요청되었다"                                     │
│     • 예: "재고 확보가 요청되었다"                         │
│                                                             │
│  2. 결과 이벤트 (타팀 → 주문팀)                            │
│     • "~가 완료되었다" / "~가 실패했다"                    │
│     • 예: "재고가 확보되었다", "재고가 부족하다"           │
│                                                             │
│  3. 주문 상태 이벤트 (주문팀 발행)                         │
│     • "주문 ~가 ~되었다"                                   │
│     • 예: "주문 결제가 완료되었다", "주문이 취소되었다"    │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  구분 예시:                                                │
│                                                             │
│  ❌ 혼란스러운 명명:                                       │
│  • "결제 완료됨" → 주문팀? 결제팀?                        │
│                                                             │
│  ✅ 명확한 명명:                                           │
│  • 결제팀: "결제가 승인되었다"                            │
│  • 주문팀: "주문 결제가 완료되었다"                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 7. 다음 문서로 이동

워크샵 실행에 대한 상세 내용은 다음 문서를 참조하세요:

- **[이벤트스토밍_주문서비스팀_워크샵실행.md](./이벤트스토밍_주문서비스팀_워크샵실행.md)**: 퍼실리테이터 스크립트, 타임라인, FAQ

---

*이 문서는 주문 서비스 개발팀 이벤트 스토밍 워크샵에서 참조할 8개 도메인의 이벤트 예시와 다른 팀과의 연동 지점을 명확히 정의하기 위해 작성되었습니다.*
